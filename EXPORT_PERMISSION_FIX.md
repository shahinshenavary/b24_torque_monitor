# ğŸ”§ Ø­Ù„ Ù…Ø´Ú©Ù„ Storage Permission Ø¨Ø±Ø§ÛŒ Export

## âš ï¸ Ù…Ø´Ú©Ù„ Ù‚Ø¨Ù„ÛŒ

```
Export Failed
Failed to export project: Exception: Export failed: Exception: Storage permission denied
Please make sure storage permission is granted
```

## âœ… Ø±Ø§Ù‡â€ŒØ­Ù„ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡

### 1ï¸âƒ£ ØªØºÛŒÛŒØ± Ø±ÙˆØ´ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ

Ø¨Ù‡ Ø¬Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² **Public Downloads** Ú©Ù‡ Ø¨Ù‡ Permission Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ø¯ØŒ Ø­Ø§Ù„Ø§ Ø§Ø² **App-Specific External Storage** Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…:

```
Ù‚Ø¨Ù„Ø§Ù‹:
/storage/emulated/0/Download/B24_Reports/  â† Ù†ÛŒØ§Ø² Ø¨Ù‡ Permission âœ—

Ø­Ø§Ù„Ø§:
/storage/emulated/0/Android/data/[app]/files/B24_Reports/  â† Ø¨Ø¯ÙˆÙ† Permission âœ“
```

### 2ï¸âƒ£ Ù…Ø²Ø§ÛŒØ§ÛŒ Ø±ÙˆØ´ Ø¬Ø¯ÛŒØ¯

âœ… **Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Permission**: Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯ 11+ Ø§Ø¬Ø§Ø²Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡ Ø¨Ø¯ÙˆÙ† permission ÙØ§ÛŒÙ„ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒÙ…  
âœ… **Ù‚Ø§Ø¨Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ**: ÙØ§ÛŒÙ„ Ø§Ø² Ø·Ø±ÛŒÙ‚ File Manager Ù‚Ø§Ø¨Ù„ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø³Øª  
âœ… **Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù‡ Ø¯Ø± Ù‡Ù…Ù‡ ÙˆØ±Ú˜Ù†â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯**: Android 6 ØªØ§ 14+  
âœ… **Ø§Ù…Ù†**: ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¯Ø± Ù…Ø³ÛŒØ± Ù…Ø®ØµÙˆØµ Ø§Ù¾ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´Ù†  

### 3ï¸âƒ£ Ù†Ø­ÙˆÙ‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ ÙØ§ÛŒÙ„

#### Ø±ÙˆØ´ 1: File Manager (ØªÙˆØµÛŒÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯)

1. **File Manager** ÛŒØ§ **My Files** Ø±Ùˆ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯
2. Ø¨Ù‡ **Internal Storage** Ø¨Ø±ÙˆÛŒØ¯
3. **Android** > **data** > **com.example.b24_torque_monitor** > **files** > **B24_Reports**
4. ÙØ§ÛŒÙ„ Excel Ø±Ùˆ Ù¾ÛŒØ¯Ø§ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯

#### Ø±ÙˆØ´ 2: Ø¬Ø³ØªØ¬Ùˆ

1. File Manager Ø±Ùˆ Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯
2. Ø§Ø² Ù‚Ø³Ù…Øª SearchØŒ Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡ Ø±Ùˆ Ø¬Ø³ØªØ¬Ùˆ Ú©Ù†ÛŒØ¯
3. ÙØ§ÛŒÙ„ `.xlsx` Ù¾ÛŒØ¯Ø§ Ù…ÛŒØ´Ù‡

#### Ø±ÙˆØ´ 3: USB Ø¨Ù‡ Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±

1. Ú¯ÙˆØ´ÛŒ Ø±Ùˆ Ø¨Ø§ USB Ø¨Ù‡ Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ± ÙˆØµÙ„ Ú©Ù†ÛŒØ¯
2. **File Transfer** (MTP) Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯
3. Ù…Ø³ÛŒØ± Ø¨Ø§Ù„Ø§ Ø±Ùˆ Ø¯Ø± Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ± Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯
4. ÙØ§ÛŒÙ„ Ø±Ùˆ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯

### 4ï¸âƒ£ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„

ÙØ§ÛŒÙ„ Ø±Ùˆ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒØ¯ Ø§Ø² File Manager Ø¨Ù‡ Ø§Ø´ØªØ±Ø§Ú© Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯:

1. ÙØ§ÛŒÙ„ Ø±Ùˆ Ø¯Ø± File Manager Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒØ¯
2. Long Press Ø±ÙˆÛŒ ÙØ§ÛŒÙ„
3. Ú¯Ø²ÛŒÙ†Ù‡ **Share** ÛŒØ§ **Send** Ø±Ùˆ Ø¨Ø²Ù†ÛŒØ¯
4. Ø±ÙˆØ´ Ø§Ø±Ø³Ø§Ù„ Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:
   - ğŸ“§ Gmail
   - ğŸ’¬ Telegram
   - ğŸ’¬ WhatsApp
   - â˜ï¸ Google Drive
   - ğŸ“¤ Bluetooth

## ğŸ”§ ØªØºÛŒÛŒØ±Ø§Øª ÙÙ†ÛŒ

### Ú©Ø¯ Ù‚Ø¨Ù„ÛŒ (Ø¨Ø§ Ù…Ø´Ú©Ù„):

```dart
// Ù†ÛŒØ§Ø² Ø¨Ù‡ Permission Ø¯Ø§Ø´Øª
final status = await Permission.storage.request();
if (!status.isGranted) {
  throw Exception('Storage permission denied');
}

directory = Directory('/storage/emulated/0/Download');
```

### Ú©Ø¯ Ø¬Ø¯ÛŒØ¯ (Ø¨Ø¯ÙˆÙ† Ù…Ø´Ú©Ù„):

```dart
// Permission Ø§Ø®ØªÛŒØ§Ø±ÛŒ - Ø§Ú¯Ø± Ù†Ø¯Ø§Ø¯ØŒ Ø§Ø² app-specific Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
await _requestStoragePermission(); // Ø³Ø¹ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù‡ Ø¨Ú¯ÛŒØ±Ù‡ØŒ Ø§Ù…Ø§ Ø§Ù„Ø²Ø§Ù…ÛŒ Ù†ÛŒØ³Øª

// Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² app-specific external storage
final externalDir = await getExternalStorageDirectory();
directory = Directory('${externalDir.path}/B24_Reports');
```

### ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ `_requestStoragePermission()`:

```dart
Future<void> _requestStoragePermission() async {
  bool granted = false;

  // Try storage permission (Android 10-)
  var status = await Permission.storage.status;
  if (status.isGranted) {
    granted = true;
  } else if (status.isDenied) {
    status = await Permission.storage.request();
    if (status.isGranted) granted = true;
  }

  // Try manageExternalStorage (Android 11+)
  if (!granted) {
    var manageStatus = await Permission.manageExternalStorage.status;
    if (manageStatus.isGranted) {
      granted = true;
    } else if (manageStatus.isDenied) {
      manageStatus = await Permission.manageExternalStorage.request();
      if (manageStatus.isGranted) granted = true;
    }
  }

  // Ø§Ú¯Ø± permission Ù†Ø¯Ø§Ø¯ØŒ Ù…Ø´Ú©Ù„ÛŒ Ù†ÛŒØ³Øª - Ø§Ø² app-specific Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
}
```

## ğŸ“± ØªØ³Øª Ø´Ø¯Ù‡ Ø±ÙˆÛŒ

âœ… Android 11 (API 30)  
âœ… Android 12 (API 31)  
âœ… Android 13 (API 33)  
âœ… Android 14 (API 34)  

## ğŸ¯ Ù†ØªÛŒØ¬Ù‡

Ø­Ø§Ù„Ø§ Export **Ø¨Ø¯ÙˆÙ† Ù‡ÛŒÚ† Ù…Ø´Ú©Ù„ Permission** Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù‡!

```
Ú©Ø§Ø±Ø¨Ø± Export Ù…ÛŒâ€ŒØ²Ù†Ù‡
    â†“
[Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Permission]
    â†“
ÙØ§ÛŒÙ„ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´Ù‡ Ø¯Ø±:
/Android/data/.../files/B24_Reports/
    â†“
âœ… Success! File saved
```

## ğŸ“ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±

ÙˆÙ‚ØªÛŒ Export Ù…ÙˆÙÙ‚ Ø´Ø¯ØŒ Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ù†Ø´ÙˆÙ† Ø¯Ø§Ø¯Ù‡ Ù…ÛŒØ´Ù‡:

```
âœ… Export Successful

File saved to:
/storage/emulated/0/Android/data/com.example.b24_torque_monitor/files/B24_Reports/Tehran_Metro_20241207_1430.xlsx

How to access:
1. Open File Manager app
2. Go to "Internal Storage"
3. Navigate to Android > data > com.example.b24_torque_monitor > files > B24_Reports

Or search for the file name in your File Manager.
```

## âš ï¸ Ù†Ú©ØªÙ‡ Ù…Ù‡Ù…

Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ø§Ù¾ Ø±Ùˆ Uninstall Ú©Ù†Ù‡ØŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø¯Ø± `Android/data/[app]/files` **Ø­Ø°Ù Ù…ÛŒâ€ŒØ´Ù†**.

Ø¨Ø±Ø§ÛŒ Backup Ø¯Ø§Ø¦Ù…ÛŒØŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ÛŒØ¯:
1. ÙØ§ÛŒÙ„ Ø±Ùˆ Export Ú©Ù†Ù‡
2. Ø§Ø² File Manager ÙØ§ÛŒÙ„ Ø±Ùˆ Share Ú©Ù†Ù‡
3. Ø¯Ø± Google Drive ÛŒØ§ Ø¬Ø§ÛŒ Ø¯ÛŒÚ¯Ù‡ Backup Ø¨Ú¯ÛŒØ±Ù‡

## ğŸ”„ Alternative: Public Downloads (Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Permission Ø¨Ø¯Ù‡)

Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Storage Permission Ø¨Ø¯Ù‡ØŒ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒÙ… ÙØ§ÛŒÙ„ Ø±Ùˆ Ø¯Ø± Public Downloads Ù‡Ù… Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒÙ…. Ø§ÛŒÙ† Ú©Ø§Ø± Ø±Ùˆ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒÙ… Ø¯Ø± Ø¢ÛŒÙ†Ø¯Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒÙ…:

```dart
if (await Permission.storage.isGranted) {
  // Save to public Downloads
  directory = Directory('/storage/emulated/0/Download/B24_Reports');
} else {
  // Save to app-specific
  directory = await getExternalStorageDirectory();
}
```

---

**Ù†Ø³Ø®Ù‡**: 1.1.1  
**ØªØ§Ø±ÛŒØ®**: 2024/12/07  
**ÙˆØ¶Ø¹ÛŒØª**: âœ… Fixed
