# ğŸ” DATA TAG Filtering System

## ğŸ¯ Ù…Ø´Ú©Ù„
- Ú†Ù†Ø¯ Ø§ÙˆÙ¾Ø±Ø§ØªÙˆØ± Ø¨Ø§ Ú†Ù†Ø¯ Ø¯Ø³ØªÚ¯Ø§Ù‡ B24 Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù†
- Ù‡Ø± Ø¯Ø³ØªÚ¯Ø§Ù‡ ÛŒÚ© DATA TAG Ù…Ù†Ø­ØµØ± Ø¨Ù‡ ÙØ±Ø¯ Ø¯Ø§Ø±Ù‡
- Ø§Ù¾ Ø¨Ø§ÛŒØ¯ ÙÙ‚Ø· Ø§Ø² Ø¯Ø³ØªÚ¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡ ÙØ¹Ù„ÛŒ Ø¯Ø§Ø¯Ù‡ Ø¨Ú¯ÛŒØ±Ù‡

---

## âœ… Ø±Ø§Ù‡â€ŒØ­Ù„

### Ú†Ø±Ø§ ÙØ±Ù…Øª 2 (Legacy)?

**ÙØ±Ù…Øª 1 (Pattern-Based):**
```
4D 80 6C C9 A4...
â””â”€â”€â”˜
Ø§ÛŒÙ† ÙÙ‚Ø· ÛŒÚ© Ù¾ØªØ±Ù† Ø«Ø§Ø¨ØªÙ‡ - Ù‡Ù…Ù‡ Ø¯Ø³ØªÚ¯Ø§Ù‡â€ŒÙ‡Ø§ Ø¯Ø§Ø±Ù†! âŒ
```

**ÙØ±Ù…Øª 2 (Legacy):** âœ…
```
01 4D 80 6C C9 A4...
   â””â”€â”€â”˜
   DATA TAG Ù…Ù†Ø­ØµØ± Ø¨Ù‡ ÙØ±Ø¯ Ù‡Ø± Ø¯Ø³ØªÚ¯Ø§Ù‡!
```

---

## ğŸ“Š Ø³Ø§Ø®ØªØ§Ø± Ø¯Ø§Ø¯Ù‡

### 1. Project Model
```dart
class Project {
  final String id;
  final String name;
  final String location;
  final List<int> deviceDataTags; // Ù„ÛŒØ³Øª DATA TAG Ù‡Ø§ÛŒ Ù…Ø¬Ø§Ø²
  
  // Ù…Ø«Ø§Ù„:
  // deviceDataTags: [0x4D80, 0x5A90, 0x6BC0]
}
```

### 2. Database Schema
```sql
CREATE TABLE projects (
  id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  location TEXT NOT NULL,
  createdAt INTEGER NOT NULL,
  deviceDataTags TEXT DEFAULT "" -- Ø°Ø®ÛŒØ±Ù‡ Ø¨Ù‡ ØµÙˆØ±Øª CSV: "19840,23184,27584"
)
```

---

## ğŸ”§ Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡

### ÙˆÙ‚ØªÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ Ø¬Ø¯ÛŒØ¯ Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒØ´Ù‡:

```dart
// Ø§ÙˆÙ¾Ø±Ø§ØªÙˆØ± DATA TAG Ù‡Ø§ÛŒ Ø¯Ø³ØªÚ¯Ø§Ù‡â€ŒÙ‡Ø§Ø´ Ø±Ùˆ ÙˆØ§Ø±Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ù‡
final project = Project(
  id: uuid(),
  name: "Site A",
  location: "Tehran",
  createdAt: DateTime.now().millisecondsSinceEpoch,
  deviceDataTags: [0x4D80, 0x5A90], // Ø¯Ø³ØªÚ¯Ø§Ù‡ A Ùˆ B
);

await DatabaseHelper.instance.insertProject(project);
```

### ÙˆÙ‚ØªÛŒ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯ Ø´Ø±ÙˆØ¹ Ù…ÛŒØ´Ù‡:

```dart
// ÙÛŒÙ„ØªØ± Ø±Ùˆ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†
B24BluetoothService.instance.setAllowedDataTags(project.deviceDataTags);

// Ø´Ø±ÙˆØ¹ Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯
await B24BluetoothService.instance.startBroadcastMonitoring();
```

### Ú†ÛŒ Ù…ÛŒØ´Ù‡ØŸ

```
ğŸ“¡ Ø¯Ø³ØªÚ¯Ø§Ù‡ A (DATA TAG: 0x4D80) â†’ âœ… Ù‚Ø¨ÙˆÙ„
ğŸ“¡ Ø¯Ø³ØªÚ¯Ø§Ù‡ B (DATA TAG: 0x5A90) â†’ âœ… Ù‚Ø¨ÙˆÙ„  
ğŸ“¡ Ø¯Ø³ØªÚ¯Ø§Ù‡ C (DATA TAG: 0x6BC0) â†’ ğŸš« Ø±Ø¯ (Ù…ØªØ¹Ù„Ù‚ Ø¨Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡ Ø¯ÛŒÚ¯Ù‡)
```

---

## ğŸ” Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Console

### Ø¯Ø³ØªÚ¯Ø§Ù‡ Ù…Ø¬Ø§Ø²:
```
ğŸ“¦ Raw Manufacturer Data (0x04C3): 01 4D 80 6C C9...
   Data Tag: 19840 (0x4D80)
   âœ… DATA TAG 19840 matches project - ACCEPTING
   Decoded Data: 30 80 DC A9 3F 4D...
âœ… B24 Data: Torque=123.45678 Nm
```

### Ø¯Ø³ØªÚ¯Ø§Ù‡ ØºÛŒØ±Ù…Ø¬Ø§Ø²:
```
ğŸ“¦ Raw Manufacturer Data (0x04C3): 01 6B C0 8A F1...
   Data Tag: 27584 (0x6BC0)
   ğŸš« DATA TAG 27584 (0x6BC0) not in allowed list - IGNORING
   ğŸ“‹ Allowed: 0x4D80, 0x5A90
```

---

## ğŸ¨ UI Workflow

### 1. ØµÙØ­Ù‡ "Create Project"

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  New Project                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Project Name: [____________]       â”‚
â”‚  Location:     [____________]       â”‚
â”‚                                     â”‚
â”‚  Devices:                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Device 1: 0x4D80             â”‚ â”‚
â”‚  â”‚ Device 2: 0x5A90             â”‚ â”‚
â”‚  â”‚ [+ Add Device]               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚
â”‚  [Create Project]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Ú†Ø·ÙˆØ±ÛŒ DATA TAG Ø±Ùˆ Ø¨Ú¯ÛŒØ±ÛŒÙ…ØŸ

**Ø±ÙˆØ´ A: Ø§Ø³Ú©Ù†**
```dart
// Ø§ÙˆÙ¾Ø±Ø§ØªÙˆØ± Ø¯Ú©Ù…Ù‡ "Scan Devices" Ø±Ùˆ Ù…ÛŒâ€ŒØ²Ù†Ù‡
final devices = await B24BluetoothService.instance.scanDevices();

// Ù„ÛŒØ³Øª Ø¯Ø³ØªÚ¯Ø§Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ DATA TAG Ù‡Ø§Ø´ÙˆÙ† Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒØ´Ù‡
for (var device in devices) {
  print("${device.name}: DATA TAG = 0x${device.dataTag.toRadixString(16)}");
}
```

**Ø±ÙˆØ´ B: Ø¯Ø³ØªÛŒ**
```
Ø§ÙˆÙ¾Ø±Ø§ØªÙˆØ± DATA TAG Ø±Ùˆ Ø§Ø² Ø±ÙˆÛŒ Ø¨Ø±Ú†Ø³Ø¨ Ø¯Ø³ØªÚ¯Ø§Ù‡ Ù…ÛŒâ€ŒØ®ÙˆÙ†Ù‡:
Ù…Ø«Ù„Ø§Ù‹: "B24-4D80" â†’ DATA TAG = 0x4D80
```

---

## ğŸ“ Ù…Ø«Ø§Ù„ Ú©Ø§Ù…Ù„

### Ø³Ù†Ø§Ø±ÛŒÙˆ:
```
Ù¾Ø±ÙˆÚ˜Ù‡ A: Ø³Ø§Ø®ØªÙ…Ø§Ù† Ø¨Ø±Ø¬ Ù…ÛŒÙ„Ø§Ø¯
â”œâ”€ Ø¯Ø³ØªÚ¯Ø§Ù‡ 1: B24-4D80 (DATA TAG: 0x4D80)
â””â”€ Ø¯Ø³ØªÚ¯Ø§Ù‡ 2: B24-5A90 (DATA TAG: 0x5A90)

Ù¾Ø±ÙˆÚ˜Ù‡ B: Ù¾Ø§Ø±Ú©ÛŒÙ†Ú¯ Ø·Ø¨Ù‚Ø§ØªÛŒ
â””â”€ Ø¯Ø³ØªÚ¯Ø§Ù‡ 3: B24-6BC0 (DATA TAG: 0x6BC0)
```

### Ú©Ø¯:
```dart
// Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡ A
final projectA = Project(
  id: "proj-001",
  name: "Milad Tower",
  location: "Tehran",
  deviceDataTags: [0x4D80, 0x5A90],
);

// Ø´Ø±ÙˆØ¹ Ú©Ø§Ø± Ø±ÙˆÛŒ Ù¾Ø±ÙˆÚ˜Ù‡ A
B24BluetoothService.instance.setAllowedDataTags(projectA.deviceDataTags);
await B24BluetoothService.instance.startBroadcastMonitoring();

// Ù†ØªÛŒØ¬Ù‡:
// âœ… Ø¯Ø³ØªÚ¯Ø§Ù‡ 1 Ùˆ 2 â†’ Ø¯Ø§Ø¯Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒØ´Ù‡
// ğŸš« Ø¯Ø³ØªÚ¯Ø§Ù‡ 3 â†’ Ù†Ø§Ø¯ÛŒØ¯Ù‡ Ú¯Ø±ÙØªÙ‡ Ù…ÛŒØ´Ù‡
```

---

## ğŸ”¢ ØªØ¨Ø¯ÛŒÙ„ DATA TAG

### Ø§Ø² Hex Ø¨Ù‡ Decimal:
```dart
int dataTag = 0x4D80;  // Hex
print(dataTag);        // 19840 (Decimal)
```

### Ø§Ø² Decimal Ø¨Ù‡ Hex:
```dart
int dataTag = 19840;
String hex = dataTag.toRadixString(16).toUpperCase(); // "4D80"
```

### Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Database:
```dart
// Ù„ÛŒØ³Øª Ø¨Ù‡ String
List<int> tags = [0x4D80, 0x5A90];
String csv = tags.join(','); // "19840,23184"

// String Ø¨Ù‡ Ù„ÛŒØ³Øª
String csv = "19840,23184";
List<int> tags = csv.split(',').map((e) => int.parse(e)).toList();
```

---

## âš™ï¸ API Methods

### ØªÙ†Ø¸ÛŒÙ… ÙÛŒÙ„ØªØ±:
```dart
// ÙÙ‚Ø· Ø§ÛŒÙ† DATA TAG Ù‡Ø§ Ù‚Ø¨ÙˆÙ„ Ù…ÛŒØ´Ù†
B24BluetoothService.instance.setAllowedDataTags([0x4D80, 0x5A90]);
```

### Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„ØªØ±:
```dart
// Ù‡Ù…Ù‡ Ø¯Ø³ØªÚ¯Ø§Ù‡â€ŒÙ‡Ø§ Ù‚Ø¨ÙˆÙ„ Ù…ÛŒØ´Ù†
B24BluetoothService.instance.clearDataTagFilter();
```

### Ú†Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„ØªØ± ÙØ¹Ù„ÛŒ:
```dart
if (_allowedDataTags.isEmpty) {
  print("No filter - accepting all devices");
} else {
  print("Filtering: ${_allowedDataTags.map((t) => '0x${t.toRadixString(16)}').join(', ')}");
}
```

---

## ğŸš€ Ù…Ø²Ø§ÛŒØ§

1. âœ… **Ø§Ù…Ù†ÛŒØª:** ÙÙ‚Ø· Ø¯Ø³ØªÚ¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¬Ø§Ø² Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒØ´Ù†
2. âœ… **Ú©Ø§Ø±Ø§ÛŒÛŒ:** Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØºÛŒØ±Ø¶Ø±ÙˆØ±ÛŒ ÙÛŒÙ„ØªØ± Ù…ÛŒØ´Ù†
3. âœ… **ØµØ­Øª:** Ù‡Ø± Ù¾Ø±ÙˆÚ˜Ù‡ ÙÙ‚Ø· Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯Ø´ Ø±Ùˆ Ø¯Ø§Ø±Ù‡
4. âœ… **Ú†Ù†Ø¯ Ø§ÙˆÙ¾Ø±Ø§ØªÙˆØ±ÛŒ:** Ú†Ù†Ø¯ Ù†ÙØ± Ù…ÛŒâ€ŒØªÙˆÙ†Ù† Ù‡Ù…Ø²Ù…Ø§Ù† Ú©Ø§Ø± Ú©Ù†Ù†

---

## ğŸ” Ø§Ù…Ù†ÛŒØª

### Ù…Ø´Ú©Ù„ Ø§Ø­ØªÙ…Ø§Ù„ÛŒ:
```
Ø§Ú¯Ù‡ Ø§ÙˆÙ¾Ø±Ø§ØªÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ÛŒ DATA TAG Ø§Ø´ØªØ¨Ø§Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù†Ù‡ Ú†ÛŒØŸ
```

### Ø±Ø§Ù‡â€ŒØ­Ù„:
```dart
// ÙˆÙ‚ØªÛŒ monitoring Ø´Ø±ÙˆØ¹ Ù…ÛŒØ´Ù‡ØŒ ÛŒÚ© Ù‡Ø´Ø¯Ø§Ø± Ù†Ø´ÙˆÙ† Ø¨Ø¯Ù‡:
if (noDataReceived for 30 seconds) {
  showDialog(
    title: "No Data Received",
    message: "Check if DATA TAG is correct: ${project.deviceDataTags}",
  );
}
```

---

## ğŸ“Š Dashboard

Ø§ÙˆÙ¾Ø±Ø§ØªÙˆØ± Ø¨Ø§ÛŒØ¯ Ø¨Ø¨ÛŒÙ†Ù‡:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Active Devices:                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŸ¢ B24-4D80 | Torque: 123.45  â”‚
â”‚  ğŸŸ¢ B24-5A90 | Torque: 98.76   â”‚
â”‚  ğŸ”´ B24-6BC0 | Blocked         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… Ø®Ù„Ø§ØµÙ‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Create Project                          â”‚
â”‚  â”œâ”€ Enter device DATA TAGs              â”‚
â”‚  â””â”€ Save to database                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Start Monitoring                        â”‚
â”‚  â”œâ”€ Set allowed DATA TAGs filter        â”‚
â”‚  â”œâ”€ Scan BLE advertising packets        â”‚
â”‚  â””â”€ Accept only matching DATA TAGs      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Receive Data                            â”‚
â”‚  â”œâ”€ Parse packet â†’ Extract DATA TAG     â”‚
â”‚  â”œâ”€ Check if in allowed list            â”‚
â”‚  â”œâ”€ âœ… Match â†’ Save to database         â”‚
â”‚  â””â”€ ğŸš« No match â†’ Ignore                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Ù†ØªÛŒØ¬Ù‡:** Ø§Ù¾ Ø§Ù„Ø§Ù† **ÙÙ‚Ø· Ø§Ø² Ø¯Ø³ØªÚ¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø¬Ø§Ø²** Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù‡! ğŸ¯
