# ๐ ุฑุงูููุง DATA TAG ู VIEW PIN ุฏุณุช

## ุชุบุฑุงุช ูุณุฎู v1.3.0

### โ ุญุฐู ุดุฏู:
- ุฏฺฉูู **Scan** ุจุฑุง ูพุฏุง ฺฉุฑุฏู ุฏุณุชฺฏุงูโูุง
- `_DeviceScanDialog` 
- ูุงุจูุช ุงุณฺฉู ุฎูุฏฺฉุงุฑ ุฏุฑ Add Project

### โ ุงุถุงูู ุดุฏู:
- ููุฏ **VIEW PIN** ุฏุฑ Add Project
- ููุฏ **DATA TAG** ุฏุณุช ุจุง validation
- ุฐุฎุฑู VIEW PIN ุฏุฑ ุฏุชุงุจุณ
- ุงุณุชูุงุฏู ุฎูุฏฺฉุงุฑ ุงุฒ VIEW PIN ูพุฑูฺู ุฏุฑ Monitoring

---

## ๐ฏ ูุญูู ุงุณุชูุงุฏู

### ูุฑุญูู 1: ุงุฌุงุฏ ูพุฑูฺู ุฌุฏุฏ

1. Login โ Projects โ **New Project**
2. ูพุฑ ฺฉุฑุฏู ุงุทูุงุนุงุช ูพุฑูฺู (ูุงูุ ูููุนุช)

### ูุฑุญูู 2: ุชูุธู ุฏุณุชฺฏุงู

#### **A) VIEW PIN:**
- ููุฏ **VIEW PIN** ุฑู ูพุฏุง ฺฉู
- ูพุดโูุฑุถ: `0000`
- ุงฺฏู VIEW PIN ุฏุณุชฺฏุงู ูุชูุงูุชูุ ุชุบุฑุด ุจุฏู
- ุญุฏุงฺฉุซุฑ 8 ฺฉุงุฑุงฺฉุชุฑ (0-9, A-Z, a-z)

#### **B) DATA TAG:**
- ุฏฺฉูู **"Add DATA TAG"** ุฑู ุจุฒู
- Dialog ุจุงุฒ ูุดู
- DATA TAG ุฑู ุจู ูุฑูุช HEX ูุงุฑุฏ ฺฉู (ูุซูุง `4D80`)
- ููุท 4 ฺฉุงุฑุงฺฉุชุฑ hex: `0-9` ู `A-F`
- ุฏฺฉูู **Add** โ DATA TAG ุงุถุงูู ูุดู
- ูโุชูู ฺูุฏุชุง DATA TAG ุงุถุงูู ฺฉู (ุจุฑุง ฺูุฏ ุฏุณุชฺฏุงู)

### ูุฑุญูู 3: Import ุดูุนโูุง

- ุฏฺฉูู **"Import from Excel"**
- ุงูุชุฎุงุจ ูุงู Excel

### ูุฑุญูู 4: ุฐุฎุฑู

- ุฏฺฉูู **Save** ุฏุฑ ุจุงูุง
- ูพุฑูฺู ุฐุฎุฑู ูุดู ุจุง VIEW PIN ู DATA TAG ูุง

---

## ๐ ูุซุงู

### ูพุฑูฺู ุจุง ฺฉ ุฏุณุชฺฏุงู:
```
Project Name: Building A - Foundation
Location: Tehran, District 2

VIEW PIN: 0000
DATA TAGs:
  - 0x4D80 (B24-4D80)
```

### ูพุฑูฺู ุจุง ฺูุฏ ุฏุณุชฺฏุงู:
```
Project Name: Building B - Piles
Location: Isfahan

VIEW PIN: 1234
DATA TAGs:
  - 0x4D80 (B24-4D80)
  - 0x5A90 (B24-5A90)
  - 0x6BC0 (B24-6BC0)
```

---

## ๐ VIEW PIN ฺุณุชุ

VIEW PIN ฺฉ ฺฉุฏ 4-8 ฺฉุงุฑุงฺฉุชุฑ ุงุณุช ฺฉู ุจุฑุง **XOR Decryption** ุฏุงุฏูโูุง B24 ุงุณุชูุงุฏู ูุดู.

### ูพุดโูุฑุถ:
- VIEW PIN = `0000`
- ุงฺฉุซุฑ ุฏุณุชฺฏุงูโูุง ุจุง ุงู PIN ฺฉุงุฑ ูโฺฉูู

### ุงฺฏู ุฏุณุชฺฏุงู PIN ูุชูุงูุช ุฏุงุฑู:
- ุงุฒ ุณุงุฒูุฏู/ูุฑูุดูุฏู ุฏุณุชฺฏุงู VIEW PIN ุฑู ุฏุฑุงูุช ฺฉู
- ุฏุฑ ููฺฏุงู ุงุฌุงุฏ ูพุฑูฺูุ PIN ุตุญุญ ุฑู ูุงุฑุฏ ฺฉู
- ุงฺฏู PIN ุงุดุชุจุงู ุจุงุดูุ ุฏุงุฏูโูุง decode ููุดู!

---

## ๐ท๏ธ DATA TAG ฺุณุชุ

DATA TAG ฺฉ ุดูุงุณู ฺฉุชุง ุจุฑุง ูุฑ ุฏุณุชฺฏุงู B24 ุงุณุช ฺฉู ุฏุฑ **advertising packets** ุงุฑุณุงู ูุดู.

### ูุฑูุช:
- 16-bit ุนุฏุฏ ุจู ุตูุฑุช Hexadecimal
- ูุซุงู: `4D80`, `5A90`, `6BC0`

### ฺุทูุฑ ูพุฏุง ฺฉููุ

#### ุฑูุด 1: ุงุฒ ุฑู ุฏุณุชฺฏุงู
- ุฑู ุฏุณุชฺฏุงู B24 ฺฉ ุจุฑฺุณุจ ุง display ูุณุช
- DATA TAG ุฑู ุงุฏุฏุงุดุช ฺฉู
- ุจู ูุฑูุช HEX (ูุซูุง `4D80`)

#### ุฑูุด 2: ุงุฒ Debug Scanner
1. ุจุฑู Debug Scanner (ุฏฺฉูู ๐)
2. ุฏฺฉูู **"Raw Scan"**
3. ุชู log ูุง ุฏูุจุงู ุงู ุฎุท ุจฺฏุฑุฏ:
   ```
   ๐ท๏ธ Legacy Format: DATA TAG = 19840 (0x4D80)
   ```
4. ููุฏุงุฑ HEX ุฑู (ูุซูุง `4D80`) ฺฉูพ ฺฉู

#### ุฑูุด 3: ุงุฒ app ุฏฺฏู (nRF Connect)
- ุฏุณุชฺฏุงู ุฑู scan ฺฉู
- Manufacturer Data ุฑู ุจุงุฒ ฺฉู
- Byte 1-2 ุฑู ุจุฎูู (Little Endian)

---

## ๐ง ุชุบุฑุงุช Database

### ูุณุฎู 5:
- ุงุถุงูู ุดุฏู ุณุชูู `viewPin` ุจู ุฌุฏูู `projects`

```sql
ALTER TABLE projects ADD COLUMN viewPin TEXT DEFAULT "0000"
```

### Migration ุฎูุฏฺฉุงุฑ:
- ุงฺฏู ุงุฒ ูุณุฎู ูุจู ุขูพุฏุช ฺฉูุ migration ุฎูุฏฺฉุงุฑ ุงุฌุฑุง ูุดู
- ูพุฑูฺูโูุง ูุฏู VIEW PIN ูพุดโูุฑุถ `0000` ูโฺฏุฑู

---

## ๐ฑ ูุญูู ฺฉุงุฑ ุฏุฑ Monitoring

ููุช Monitoring ุฑู ุดุฑูุน ูโฺฉู:

1. **VIEW PIN ูพุฑูฺู** ุฎูุงูุฏู ูุดู
2. `B24BluetoothService.instance.setViewPin(project.viewPin)` ูุฑุงุฎูุงู ูุดู
3. **DATA TAG ูุง ูพุฑูฺู** ููุชุฑ ูุดู
4. ููุท ุฏุณุชฺฏุงูโูุง ฺฉู DATA TAG ุดูู ุฏุฑ ูุณุช ูพุฑูฺู ูุณุชุ ูุจูู ูุดู
5. Decryption ุจุง VIEW PIN ุตุญุญ ุงูุฌุงู ูุดู

### Log ูุง:
```
๐ VIEW PIN set to: 0000
๐ Filtering devices for project 'Building A':
   Allowed DATA TAGs: 0x4D80, 0x5A90
```

---

## โ๏ธ ูฺฉุงุช ููู

### โ ุญุชูุงู ุงู ฺฉุงุฑูุง ุฑู ุงูุฌุงู ุจุฏู:
1. **VIEW PIN ุตุญุญ:** ุงฺฏู ุงุดุชุจุงู ุจุงุดูุ ุฏุงุฏู decode ููุดู
2. **DATA TAG ุฏูู:** ุจุงุฏ ุฏููุงู ุจุง ุฏุณุชฺฏุงู match ฺฉูู
3. **ูุฑูุช HEX:** ููุท `0-9` ู `A-F`
4. **ุญุฏุงูู ฺฉ DATA TAG:** ุจุฏูู DATA TAG ููโุชูู ูพุฑูฺู save ฺฉู

### โ ุงุดุชุจุงูุงุช ุฑุงุฌ:
1. **VIEW PIN ุงุดุชุจุงู** โ ุฏุงุฏูโูุง garbage ูโุดู
2. **DATA TAG decimal** โ ุจุงุฏ HEX ุจุงุดู (ูุซูุง `4D80` ูู `19840`)
3. **Case sensitive ูุจูุฏู** โ `4d80` ู `4D80` ฺฉุณุงูู (auto uppercase ูุดู)

---

## ๐งช ุชุณุช

### ุชุณุช VIEW PIN:
1. ูพุฑูฺู ุจุง VIEW PIN ุงุฌุงุฏ ฺฉู
2. ุจุฑู Monitoring
3. ฺฺฉ ฺฉู log: `๐ VIEW PIN set to: 0000`
4. ุงฺฏู ุฏุงุฏูโูุง decode ุดุฏู โ PIN ุตุญุญู โ
5. ุงฺฏู ุฏุงุฏูโูุง garbage ูุณุชู โ PIN ุงุดุชุจุงูู โ

### ุชุณุช DATA TAG:
1. ูพุฑูฺู ุจุง DATA TAG ุงุฌุงุฏ ฺฉู
2. ุจุฑู Monitoring
3. ฺฺฉ ฺฉู log: `Allowed DATA TAGs: 0x4D80`
4. ููุท ุฏุณุชฺฏุงู ุจุง ูููู DATA TAG ุจุงุฏ accept ุจุดู
5. ุฏุณุชฺฏุงูโูุง ุฏฺฏู: `๐ซ DATA TAG ... not in allowed list - IGNORING`

---

## ๐ ูุซุงู ฺฉุงูู

```
๐ฏ Scenario: ูพุฑูฺู ุจุง 2 ุฏุณุชฺฏุงู B24

Project Info:
  Name: "Building Foundation"
  Location: "Tehran"
  
Device Config:
  VIEW PIN: "0000"
  DATA TAGs:
    - 0x4D80 (Device 1)
    - 0x5A90 (Device 2)
    
Excel Import:
  50 piles imported
  
Save โ Done!

ุฏุฑ Monitoring:
  โ Device B24-4D80 accepted
  โ Device B24-5A90 accepted
  โ Device B24-6BC0 rejected (not in list)
  
Decryption:
  VIEW PIN "0000" โ Success โ
  Torque data: 125.45 Nm
```

---

## ๐ ูุงูโูุง ุชุบุฑ ุงูุชู

```
/aaa/lib/
โโโ models/
โ   โโโ project.dart              โ ุงุถุงูู ุดุฏ viewPin field
โโโ database/
โ   โโโ database_helper.dart      โ Migration ุจู v5
โโโ pages/
    โโโ add_project_page.dart     โ ุญุฐู Scanุ ุงุถุงูู Manual inputs
    โโโ monitoring_page.dart      โ ุงุณุชูุงุฏู ุงุฒ project.viewPin
```

---

## ๐ ุณูุงูุงุช ูุชุฏุงูู

**Q: ฺุทูุฑ DATA TAG ุฑู ูพุฏุง ฺฉููุ**  
A: ุงุฒ Debug Scanner ุงุณุชูุงุฏู ฺฉู ุง ุฑู ุฏุณุชฺฏุงู ุจุฑฺุณุจ ุฏุงุฑู

**Q: VIEW PIN ูพุดโูุฑุถ ฺูุ**  
A: `0000` - ุงฺฉุซุฑ ุฏุณุชฺฏุงูโูุง ุงู ุฑู ุฏุงุฑู

**Q: ูโุชููู ฺูุฏ DATA TAG ุงุถุงูู ฺฉููุ**  
A: ุจููุ ุจุฑุง ูุฑ ุฏุณุชฺฏุงู ฺฉ

**Q: ุงฺฏู VIEW PIN ุฑู ุงุดุชุจุงู ุจุฒูู ฺ ูุดูุ**  
A: ุฏุงุฏูโูุง decode ููุดู ู ุนุฏุฏูุง ุงุดุชุจุงู ูโุจู

**Q: ูโุชููู ุจุนุฏุงู VIEW PIN ุฑู ุชุบุฑ ุจุฏูุ**  
A: ูุนูุงู ููุ ุจุงุฏ ูพุฑูฺู ุฌุฏุฏ ุจุณุงุฒ. ุขูพุฏุช ุจุนุฏ ุงุถุงูู ูุดู

---

**ูุณุฎู:** v1.3.0  
**ุชุงุฑุฎ:** 2024-12-07
